<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Program the Blockchain | Initial Coin Offering Example</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">

    <link href='tachyons.min.css' rel='stylesheet' type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link href="https://fonts.googleapis.com/css?family=Lato:100,300,300i,700,700i" rel="stylesheet">
    <link href='./css/icons.css' rel='stylesheet' type="text/css" />
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
    <style>
      figure img {
        display: block;
        margin: 0 auto;
      }
      pre, .pre  {
        overflow-x: auto;
        overflow-y: hidden;
      }

      code {
        font-family: inconsolata, Menlo, Monaco, Consolas, "Courier New", monospace;
      }

      code {
        padding: 0.2em;
        font-size: 85%;
        background-color: rgba(27,31,35,.05);
        border-radius: 3px;
      }

      pre code {
        background-color: transparent;
        display: block;
        padding: 1.5em;
        white-space: pre;
        font-size: .875rem;
        line-height: 1.25;
      }

      pre {
        white-space: pre;

        hyphens: none;
        position: relative;
      }

      blockquote {
        margin-top: 0;
        margin-left: 0;
        padding-left: 2rem;
        color: rgba(0, 0, 0, 0.9);
        font-family: athelas, georgia, serif;
        border-width: 0.25rem;
        border-color: #357edd;
        border-left-style: solid;
      }

      cite {
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-style: normal;
      }

      aside {
        position: absolute;
        width: 180px;
        right: -186px;
        font-size: 14px;
        border-left: 1px solid #ccc;
        padding-left: 16px;
      }

      @media (min-width: 960px) {
        .article-container.has-footnotes {
          margin-left: -120px;
          position: relative;
        }
        .footnotes, .footnote-ref {
          display: none;
        }
      }

      @media (max-width: 960px) {
        aside {
          display: none;
        }
      }

      .footnote-ref a, a.footnote-return {
        text-decoration: none;
      }

       
      .mc-banner {
        visibility: hidden !important;
      }
      .mc-modal, .mc-modal-bg {
        visibility: visible !important;
      }

      strong {
        font-weight: 700;
      }

      .sans-serif {
        font-family: Lato, sans-serif;
      }
    </style>

    <meta property="og:title" content="Initial Coin Offering Example" />
<meta property="og:description" content="@keyframes spin { 0% { transform: rotate(0deg); } to { transform:rotate(1turn); } }   Loading...  Your current balance: 0 SET. Buy more! Each token costs 0.0001 ether. Number of tokens to buy      0 / 0 tokens sold so far info icon   NOTE: Due to a bug in MetaMask, events may not work after switching networks (e.g. from the main network to the Ropsten test network)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://programtheblockchain.com/dapps/ico/" />
















      <meta property="og:image" content="https://programtheblockchain.com/images/bigicon.png" />
    
<meta itemprop="name" content="Initial Coin Offering Example">
<meta itemprop="description" content="@keyframes spin { 0% { transform: rotate(0deg); } to { transform:rotate(1turn); } }   Loading...  Your current balance: 0 SET. Buy more! Each token costs 0.0001 ether. Number of tokens to buy      0 / 0 tokens sold so far info icon   NOTE: Due to a bug in MetaMask, events may not work after switching networks (e.g. from the main network to the Ropsten test network).">



<meta itemprop="wordCount" content="608">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://programtheblockchain.com/images/bigicon.png"/>

<meta name="twitter:title" content="Initial Coin Offering Example"/>
<meta name="twitter:description" content="@keyframes spin { 0% { transform: rotate(0deg); } to { transform:rotate(1turn); } }   Loading...  Your current balance: 0 SET. Buy more! Each token costs 0.0001 ether. Number of tokens to buy      0 / 0 tokens sold so far info icon   NOTE: Due to a bug in MetaMask, events may not work after switching networks (e.g. from the main network to the Ropsten test network)."/>

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-109050146-1"></script>
    <script>
      if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
        console.log("Not running Google Analytics on localhost.");
      } else {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-109050146-1');
      }
    </script>
    
    <script src='./js/jquery-3.2.1.min.js'></script>
  </head>

  <body class="w-100 sans-serif bg-white">
    <nav class="db dt-l w-100 border-box pa3 ph5-l b--black-10 bb" style="min-height:74px">
	
	<a class="db dtc-l v-mid black link w-100 w-25-l tc tl-l mb2 mb0-l" href='https://programtheblockchain.com/' title="Home">
		<img src="images/ptb.png" alt="Program the Blockchain">
	</a>
	
	<div class="db dtc-l v-mid w-100 w-75-l tc tr-l fw1">
		<a class="link dim black f6 f5-l dib mr3 mr4-l" href="https://programtheblockchain.com/posts" title="Archive">Archive</a>
		<a class="link dim black f6 f5-l dib mr3 mr4-l" href="https://programtheblockchain.com/about" title="About">About</a>
		<a class="link dim black f6 f5-l dib" href="#" title="Subscribe" id="header-subscribe">Subscribe</a>
	</div>
</nav>


    <main class="mw7 center" role="main">
      
<script src='./js/web3.min.js'></script>
<script src='./js/ethereumjs-all-2018-1-17.min.js'></script>
<script src='./js/moment.min.js'></script>

<div class='flex-l mt2 w8 center article-container'>
<article class="cf pv5 ph3 ph4-ns w-100">
  <header>
    <h1 class="f1 mb1">
      Initial Coin Offering Example
    </h1>
  </header>
  <div class="lh-copy fw3 f4 dark-gray">
    <style>
  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    to {
      transform:rotate(1turn);
    }
  }
</style>

<div id="spinner" class="mt5">
  <div style="margin: 0px auto; border-radius: 100%; border-width: 3px; border-style: solid; border-color: rgb(33, 150, 243) rgb(238, 238, 238) rgb(238, 238, 238); border-image: initial; width: 32px; height: 32px; animation: spin 0.8s linear infinite;"></div>
  <small class="tc db f6 black-60">Loading...</small>
</div>
<div id="ui" class="dn">
  <p class="mt4">
    Your current balance: <span id="owned">0</span> SET.
    Buy more! Each token costs 0.0001 ether.
  </p>
  <form id="buyForm" class="br2-ns">
    <fieldset class="cf bn ma0 pa0">
      <div class="cf">
        <label class="clip" for="number">Number of tokens to buy</label>
        <input class="f6 f5-l input-reset bn bg-near-white fl black-80 pa3 lh-solid w-100 w-75-m w-80-l br2-ns br--left-ns" placeholder="Number of tokens to buy" type="number" name="number" value="1" min="1" id="number">
        <input class="f6 f5-l button-reset fl pv3 tc bn bg-animate bg-green hover-bg-dark-green white pointer w-100 w-25-m w-20-l br2-ns br--right-ns" type="submit" value="Buy Tokens">
      </div>
    </fieldset>
  </form>

  <div class="bg-moon-gray br-pill h1 overflow-y-hidden mt3">
    <div id="progress" class="bg-blue br-pill h1" style="width:0px"></div>
  </div>
  <small class="f6 black-60 db mb2 tr"><span id="sold">0</span> / <span id="total">0</span> tokens sold so far</small>

  <div class="flex items-center justify-center pa4 bg-lightest-blue navy mt4">
    <svg class="w1" data-icon="info" viewBox="0 0 32 32" style="fill:currentcolor;width:80px">
      <title>info icon</title>
      <path d="M16 0 A16 16 0 0 1 16 32 A16 16 0 0 1 16 0 M19 15 L13 15 L13 26 L19 26 z M16 6 A3 3 0 0 0 16 12 A3 3 0 0 0 16 6"></path>
    </svg>
    <span class="lh-title ml3"><strong>NOTE</strong>: Due to a bug in MetaMask, events may not work after switching networks (e.g. from the main network to the Ropsten test network). If you experience this, you need to restart the browser after switching to the desired network.</span>
  </div>
</div>



<script>
  var minimalTokenABI = [
  	{
  		"constant": true,
  		"inputs": [
  			{
  				"name": "",
  				"type": "address"
  			}
  		],
  		"name": "balanceOf",
  		"outputs": [
  			{
  				"name": "",
  				"type": "uint256"
  			}
  		],
  		"payable": false,
  		"stateMutability": "view",
  		"type": "function"
  	},
  	{
  		"anonymous": false,
  		"inputs": [
  			{
  				"indexed": true,
  				"name": "from",
  				"type": "address"
  			},
  			{
  				"indexed": true,
  				"name": "to",
  				"type": "address"
  			},
  			{
  				"indexed": false,
  				"name": "value",
  				"type": "uint256"
  			}
  		],
  		"name": "Transfer",
  		"type": "event"
  	},
  ];

  var saleABI = [
  	{
  		"constant": true,
  		"inputs": [],
  		"name": "tokensSold",
  		"outputs": [
  			{
  				"name": "",
  				"type": "uint256"
  			}
  		],
  		"payable": false,
  		"stateMutability": "view",
  		"type": "function"
  	},
  	{
  		"constant": true,
  		"inputs": [],
  		"name": "tokenContract",
  		"outputs": [
  			{
  				"name": "",
  				"type": "address"
  			}
  		],
  		"payable": false,
  		"stateMutability": "view",
  		"type": "function"
  	},
  	{
  		"constant": true,
  		"inputs": [],
  		"name": "price",
  		"outputs": [
  			{
  				"name": "",
  				"type": "uint256"
  			}
  		],
  		"payable": false,
  		"stateMutability": "view",
  		"type": "function"
  	},
  	{
  		"anonymous": false,
  		"inputs": [
  			{
  				"indexed": false,
  				"name": "buyer",
  				"type": "address"
  			},
  			{
  				"indexed": false,
  				"name": "amount",
  				"type": "uint256"
  			}
  		],
  		"name": "Sold",
  		"type": "event"
  	},
  	{
  		"constant": false,
  		"inputs": [
  			{
  				"name": "numberOfTokens",
  				"type": "uint256"
  			}
  		],
  		"name": "buyTokens",
  		"outputs": [],
  		"payable": true,
  		"stateMutability": "payable",
  		"type": "function"
  	},
  	{
  		"constant": false,
  		"inputs": [],
  		"name": "endSale",
  		"outputs": [],
  		"payable": false,
  		"stateMutability": "nonpayable",
  		"type": "function"
  	},
  	{
  		"inputs": [
  			{
  				"name": "_tokenContract",
  				"type": "address"
  			},
  			{
  				"name": "_price",
  				"type": "uint256"
  			}
  		],
  		"payable": false,
  		"stateMutability": "nonpayable",
  		"type": "constructor"
  	}
  ];
  var saleAddress = '0x635a615769f044eaba81f7ae9797d9901a5b09e5';

  var saleContract = web3.eth.contract(saleABI).at(saleAddress);

  // These values could be determined dynamically at runtime, but they never
  // change, so there's no harm in hard-coding them, and it saves us network
  // round-trips.
  var tokenAddress = '0xe1e545c89f3996cf06e1f12c6d05e3412c7c7b11';
  var tokenContract = web3.eth.contract(minimalTokenABI).at(tokenAddress);
  var decimals = 18;
  var price = 100000000000000;

  // "Animate" by changing the text with each animation step.
  function animateTo(el, value) {
    $({ number: parseFloat(el.text().replace(/[^\d.]/g, '')) }).animate(
      { number: value },
      {
        step: function () {
          el.text(Math.floor(this.number).toLocaleString());
        },
        complete: function () {
          el.text(this.number.toLocaleString());
        },
      });
  }

  var start = +(new Date());
  function updateUI(owned, sold, remaining) {
    // Delay first UI update until the spinner has been visible for 1 second.
    if (+(new Date()) - start < 1000) {
      return window.setTimeout(function () {
        updateUI(owned, sold, remaining);
      }, 1000 - +(new Date()) + start);
    }

    // sold and total are both BigNumbers
    var total = sold.plus(remaining);

    $('#ui').show();
    $('#spinner').hide();
    animateTo($('#owned'), owned.toNumber());
    animateTo($('#sold'), sold.toNumber());
    animateTo($('#total'), total.toNumber());
    $('#price')
    $('#progress').animate({
      // Safe BigNumber math
      width: Math.round(sold.mul(100).div(total).toNumber()).toString() + '%',
    });
  }

  $('#buyForm').submit(function (e) {
    // Prevent the browser from POSTing the form.
    e.preventDefault();

    var numberOfTokens = web3.toBigNumber($('#number').val());
    saleContract.buyTokens.sendTransaction(numberOfTokens, {
      value: numberOfTokens.mul(price),
    }, function () {
      // Nothing to do here. If the transaction is successful, it will trigger
      // events that we're already monitoring.
    });
  });

  function loadData(blockNumber) {
    log("Loading data from contracts...")

    var balance, sold, remaining;

    // Callback that waits for all three pieces of data before proceeding
    function updateWhenDone() {
      if (balance !== undefined && sold !== undefined &&
          remaining !== undefined) {
        log("Updating UI.");
        updateUI(balance.div(10**decimals), sold, remaining.div(10**decimals));
      }
    }

    // Fetch in parallel
    // User's balance
    tokenContract.balanceOf.call(web3.eth.defaultAccount, {}, blockNumber,
      function (err, _balance) {
        if (err) return error(err);
        balance = _balance;
        updateWhenDone();
      });
    // Tokens sold so far
    saleContract.tokensSold.call({}, blockNumber,
      function (err, _sold) {
        if (err) return error(err);
        sold = _sold;
        updateWhenDone();
      });
    // Remaining inventory (sale contract's balance)
    tokenContract.balanceOf.call(saleAddress, {}, blockNumber,
      function (err, _remaining) {
        if (err) return error(err);
        remaining = _remaining;
        updateWhenDone();
      });
  }

  function initialize() {
    web3.eth.getBlockNumber(function (err, lastSeenBlock) {
      // Load data for the initial block
      loadData(lastSeenBlock);

      // Handler for events that necessitate a UI update
      function changeHandler(err, data) {
        if (err) return error(err);

        // Only if we haven't already fetched data for this block
        if (data.blockNumber > lastSeenBlock) {
          lastSeenBlock = data.blockNumber;
          loadData(lastSeenBlock);
        }
      }

      // The Sold event tells us when the number of sold tokens changes.
      saleContract.Sold(changeHandler);

      // We display the user's balance as well as the sale contract's
      // balance, so we need to monitor transfers to both.
      tokenContract.Transfer({
        to: [ saleAddress, web3.eth.defaultAccount ]
      }, changeHandler);

      // To display an accurate balance, we also need to monitor transfers out
      // of the user's account.
      tokenContract.Transfer({
        from: web3.eth.defaultAccount
      }, changeHandler);
    });
  }

  $(function () {
    if (typeof(web3) === "undefined") {
      error("Unable to find web3. " +
      "Please run MetaMask (or something else that injects web3).");
    } else {
      log("Found injected web3.");
      web3 = new Web3(web3.currentProvider);
      if (web3.version.network != 3) {
        error("Wrong network detected. Please switch to the Ropsten test network.");
      } else {
        log("Connected to the Ropsten test network.");
        if (web3.eth.defaultAccount === undefined) {
          error("No accounts found. If you're using MetaMask, " +
  				      "please unlock it first.");
        } else {
          initialize();
        }
        var initialAccount = web3.eth.defaultAccount;
        window.setInterval(function () {
          if (web3.eth.defaultAccount !== initialAccount) {
            window.location.reload();
          }
        }, 500);
      }
    }
  });
</script>

  </div>
</article>
</div>

<h2>Log</h2>
<div class="code f6 lh-solid overflow-auto ph3 ba b--moon-gray" style="height:16em" id="log">
</div>
<script>
	function log(message) {
		$('#log').append($('<p>').text(message));
		$('#log').scrollTop($('#log').prop('scrollHeight'));
	}

	function error(message) {
		$('#log').append($('<p>').addClass('dark-red').text(message));
		$('#log').scrollTop($('#log').prop('scrollHeight'));
	}

	function waitForReceipt(hash, cb) {
		web3.eth.getTransactionReceipt(hash, function (err, receipt) {
			if (err) {
				error(err);
			}

			if (receipt !== null) {
				
				if (cb) {
					cb(receipt);
				}
			} else {
				
				window.setTimeout(function () {
					waitForReceipt(hash, cb);
				}, 1000);
			}
		});
	}
</script>

    </main>
    <footer class="pv4 ph3 ph5-ns tc">
	<a class="link dim gray dib h2 w2 br-100 mr3" href="#" title="Subscribe via email" id="footer-subscribe">
		<svg data-icon="email" viewBox="0 0 512 512" style="fill:currentcolor">
			<title>Email icon</title>
			<path d="M101.3 141.6v228.9h0.3 308.4 0.8V141.6H101.3zM375.7 167.8l-119.7 91.5 -119.6-91.5H375.7zM127.6 194.1l64.1 49.1 -64.1 64.1V194.1zM127.8 344.2l84.9-84.9 43.2 33.1 43-32.9 84.7 84.7L127.8 344.2 127.8 344.2zM384.4 307.8l-64.4-64.4 64.4-49.3V307.8z"/>
		</svg>
	</a>
	<a class="link dim gray dib h2 w2 br-100 mr3" href="https://programtheblockchain.com/rss.xml" title="RSS feed">
		<svg data-icon="rss" viewBox="0 0 512 512" style="fill:currentcolor">
			<title>RSS icon</title>
			<path d="M201.8 347.2c0 20.3-16.5 36.8-36.8 36.8 -20.3 0-36.8-16.5-36.8-36.8s16.5-36.8 36.8-36.8C185.3 310.4 201.8 326.8 201.8 347.2zM128.2 204.7v54.5c68.5 0.7 124 56.3 124.7 124.7h54.5C306.7 285.3 226.9 205.4 128.2 204.7zM128.2 166.6c57.9 0.3 112.3 22.9 153.2 63.9 41 41 63.7 95.5 63.9 153.5h54.5c-0.3-149.9-121.7-271.4-271.6-271.9V166.6L128.2 166.6z"/>
		</svg>
	</a>
	<a class="link dim gray dib h2 w2 br-100 mr3" href="https://twitter.com/ProgramTheBlock" title="Twitter">
		<svg data-icon="twitter" viewBox="0 0 32 32" style="fill:currentcolor">
			<title>Twitter icon</title>
			<path d="M2 4 C6 8 10 12 15 11 A6 6 0 0 1 22 4 A6 6 0 0 1 26 6 A8 8 0 0 0 31 4 A8 8 0 0 1 28 8 A8 8 0 0 0 32 7 A8 8 0 0 1 28 11 A18 18 0 0 1 10 30 A18 18 0 0 1 0 27 A12 12 0 0 0 8 24 A8 8 0 0 1 3 20 A8 8 0 0 0 6 19.5 A8 8 0 0 1 0 12 A8 8 0 0 0 3 13 A8 8 0 0 1 2 4"></path>
		</svg>
	</a>
</footer>

    
<script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false">
</script>
<script type="text/javascript">
	function showSubscribeModal(e) {
		e.preventDefault();
		document.cookie = 'MCPopupClosed=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT';
		document.cookie = 'MCPopupSubscribed=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT';
		require(["mojo/signup-forms/Loader"], function(L) {
			L.start({"baseUrl":"mc.us17.list-manage.com","uuid":"7f92ce5fb34212b812549be4b","lid":"be1cac3765"});
		});		
	}
	document.getElementById('header-subscribe').addEventListener('click', showSubscribeModal);
	document.getElementById('footer-subscribe').addEventListener('click', showSubscribeModal);
</script>


<script>
	$(function () {
		$('.footnotes li').each(function (i, el) {
			var html = $(el).html().replace(/\s*<a class="footnote-return"[^>]*>↩<\/a>$/, "");
			$('<aside>').html(html).insertBefore($('sup#fnref\\:' + (i + 1)).parent('p,li'));
		});
		$('a.expand').click(function (e) {
			e.preventDefault();
			$(this).toggleClass('icon-up').toggleClass('icon-down').blur().parent('div').next('.expandable').toggle();
		});
	});
</script>

  </body>
</html>
